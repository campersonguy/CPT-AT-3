<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="..\..\static\css\style.css" />
    <link rel="icon" type="image/x-icon" href="..\static\images\favicon.png" />
    <title>confessions.com - Crime</title>
    <nav>
        <ul>
            <li><a href="top_crimes">Top Crimes</a></li>
            <li><a href="search_crimes">Search Crimes</a></li>
            <li><a href="submit_crimes">Submit Crimes</a></li>
            <li><a href="profile">Your Profile</a></li>
            <li><a><img src="..\static\images\logo.png" alt="logo" class="logo"></a></li>
        </ul>
    </nav>
</head>

<body>
    <h1 class="tc">Crime Page</h1><br>
    <h4 class="tc">Read, comment and like a crime!</h3><br><br>
        <div class="two-columns" style="margin-left: 190px;" id="div">
            <p class="crime" id="p1"><span id="c1"></span><span id="c2"></span><span id="c3"></span></p><br>
            <p class="crime" id="p2"></p><br>
            <p class="new-column"><strong>Comments:</strong></p><br>
            <form id="signup" action="/crime" method="POST" style="margin: 0">
                <textarea size="360" placeholder="Add a comment..." name="comm" class="lg"
                    style="width: 400px; height: 60px;"></textarea>
                <input type="hidden" name="postid" id="i1" />
                <br><br>
                <button id="enter" style="margin: 0;">Enter</button><br>
            </form>
        </div>
</body>

<script id="crime" type="application/json">
    {{ crime | tojson | safe }}
</script>
<script id="data" type="application/json">
    {{ data | tojson | safe }}
</script>
<script id="comm" type="application/json">
    {{ commdata | tojson | safe }}
</script>
<script id="liked" type="application/json">
    {{ liked | tojson | safe }}
</script>
<script>
    const crime = JSON.parse(document.getElementById("crime").textContent);
    const data = JSON.parse(document.getElementById("data").textContent);
    const comm = JSON.parse(document.getElementById("comm").textContent);
    const liked = JSON.parse(document.getElementById("liked").textContent);
    const c1 = document.getElementById("c1");
    const c2 = document.getElementById("c2");
    const c3 = document.getElementById("c3");
    const p2 = document.getElementById("p2");
    const div = document.getElementById("div");
    const i1 = document.getElementById("i1");
    console.log(crime);

    document.addEventListener("DOMContentLoaded", () => {
        for (let i = 0; i < data.length; i++) {
            if (data[i][2] === crime.c) {
                c1.innerHTML = `<strong> ${data[i][2]} - ${data[i][1]} - (${data[i][5].replace('\n', '<br>')})</strong><br>👁&nbsp;${data[i][6]}&nbsp;`;
                if (liked === false) {
                    c2.innerHTML = `👍🏻`;
                } else {
                    c2.innerHTML = `👍`;
                }
                console.log(data[i][7]);
                c3.innerHTML = `&nbsp;${data[i][7]}`;
                p2.innerHTML = `${data[i][3].replace('\n', '<br>')}`;
                i1.value = data[i][0];
                for (let i1 = 0; i1 < comm.length; i1++) {
                    // console.log(comm[i1][1]);
                    // console.log(data[i][0])
                    if (comm[i1][1] === data[i][0]) {
                        const br = document.createElement("br");
                        div.appendChild(br);
                        const p = document.createElement("p");
                        div.appendChild(p);
                        p.classList.add("crime");
                        p.innerHTML = `<strong>${comm[i1][2]} (${comm[i1][4]})</strong><br>${comm[i1][3].replace('\n', '<br>')}`;
                    }
                }
            }
        }
    });

    c2.addEventListener("click", async (event) => {
        if (c2.innerHTML = `👍`) {
            c2.innerHTML = `👍🏻`;
        } else {
            c2.innerHTML = `👍`;
        }
        fetch("/like", {
            method: "POST"
        });
        window.location.reload();
    });
</script>

</html>